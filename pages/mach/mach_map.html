---
layout: base_page
title: 农机跟踪
---

{% include mapScript.html %}
{% include temp/control_head.html %}

<div class="main_container">
    <div class="row full_height">
        <div class="col-md-9 map_part border">
            <div class="row map_top border">
                <div id="map_container"></div>
            </div>
            <div class="row map_bottom border">
                <div id="operation">
                    <input type="button" value="跳转到当前位置" onclick="goCurrentPosition()"/>
                    <input type="button" value="跳转到双沟镇" onclick="goShuangGou()"/>
                    <input type="button" value="清除所有覆盖物" onclick="clearAll()"/>
                </div>
            </div>
        </div>
        <div class="col-md-3 info_part border">
            <div class="row">
                <div class="col-md-12">
                    {% include temp/datetime.html id='dtp_start' text='开始时间:' %}
                    {% include temp/datetime.html id='dtp_end' text='结束时间:' %}
                    {% include temp/textbox.html id='dtp_car' text='车牌号:' placeholder='请输入车牌号' showButton = true %}
                    {% include temp/simple_table.html %}
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    var map = initMap('map_container');

    var simpleTableGen = new SimpleTableGen();
    var settings = new Object();
    settings.columns = [{
        field: 'state',
        checkbox: true,
        align: 'center',
        valign: 'middle'
    }, {
        field: 'machCode',
        title: '车号',
        align: 'center',
    }, {
        field: 'machName',
        title: '车型',
        align: 'center',
    }];

    settings.url = API_URL + '/api/gpsRecords';

    var points = new Array();

    settings.onCheckAll = function (rows) {
        rows.forEach(function (row) {
            var point = new BMap.Point(row.lng, row.lat);
            points.push(point);
        });
        console.log(points);
        var polyline = new BMap.Polyline(points);
        map.addOverlay(polyline);
    }
//    clickMapShowLocation();

    simpleTableGen.settings = settings;
    simpleTableGen.bind();

</script>